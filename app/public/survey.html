<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FriendFinder</title>
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Wendy+One|Bitter" rel="stylesheet">
    <style>
    h2 {
        font-family: 'Wendy One', sans-serif;
        text-align: center;
        margin-top: 60px;
    }
    
    h3 {
        font-family: 'Bitter', serif;
        font-size: 30px;
    }
    
    h4 {
        font-family: 'Bitter', serif;
        font-size: 20px;
    }
    
    .footer {
        height: 20px;
        line-height: 3em;
        text-align: center;
    }
    
    #submit {
        margin-left: 0;
        width: 100%;
    }
    
    .header-info {
        text-align: center;
    }
    </style>
</head>

<body>
    <div class="container">
        <h2>Survey Questions</h2>
        <hr>
        <div class="header-info">
            <h3><strong>About You</strong></h3>
            <h4>Name (Required)</h4>
            <div class="input-field col s12">
                <input type="text" name="" id="name" class="form-control" required>
                <label for="name">Name</label>
            </div>
            <h4>Link to Photo Image (Required)</h4>
            <div class="input-field col s12">
                <input type="text" name="" id="photo" class="form-control" required>
                <label for="photo">Link to Photo</label>
            </div>
        </div>
        <br>
        <h3><strong>Question 1</strong></h3>
        <h4>You prefer cats to dogs.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q1">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 2</strong></h3>
        <h4>You would eat a cheeseburger over a salad.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q2">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 3</strong></h3>
        <h4>You are outgoing.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q3">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 4</strong></h3>
        <h4>You prefer to cook your meals rather than eat out.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q4">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 5</strong></h3>
        <h4>You enjoy long walks on the beach.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q5">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 6</strong></h3>
        <h4>If something upsets you, you tend to take it out on other people.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q6">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 7</strong></h3>
        <h4>You enjoy reading for fun.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q7">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 8</strong></h3>
        <h4>You prefer outdoor activities to indoor activities.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q8">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 9</strong></h3>
        <h4>You value love and family over money.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q9">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <h3><strong>Question 10</strong></h3>
        <h4>You enjoy eating fast food.</h4>
        <div class="row">
            <div class="input-field col s12" class="questions">
                <select id="q10">
                    <option value="">Please Select One</option>
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                </select>
            </div>
        </div>
        <br>
        <br>
        <!-- Submit Button -->
        <button type="submit" class="waves-effect waves-light btn" id="submit">Submit</button>
        <hr>
        <footer class="footer">
            <div class="container">
                <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/Skylarann725/FriendFinder">GitHub Repo</a></p>
            </div>
        </footer>
    </div>
    <!-- Modal Structure -->
    <div id="resultsModal" class="modal">
        <div class="modal-content center-align">
            <h4 class="result-text">Your best match is: </h4>
            <h2 class="result-text" id="matchName"></h2>
            <img id="matchImg" src="" alt="" />
        </div>
        <div class="modal-footer">
            <a id="close" class="modal-action modal-close waves-effect waves-green btn-flat">Close</a>
        </div>
    </div>
    <script type="text/javascript">
    // initializing materialize select element
    $('select').material_select();
    // initializing materialize modal element
    $('#resultsModal').modal();

    // Capture the form inputs 
    $("#submit").on("click", function(event) {
        event.preventDefault();
        // Form validation to make sure all fields are filled out
        function validateForm() {
            var isValid = true;
            $('.form-control').each(function() {
                if ($(this).val() === '')
                    isValid = false;
            });

            $('.questions').each(function() {
                console.log(isValid);

                if ($(this).val() === "")
                    isValid = false
            })
            return isValid;
        } // end of validateForm

        // If all required fields are filled
        if (validateForm() == true) {
            // Create an object for the user's data
            var userData = {
                name: $("#name").val(),
                photo: $("#photo").val(),
                scores: [$("#q1").val(), $("#q2").val(), $("#q3").val(), $("#q4").val(), $("#q5").val(), $("#q6").val(), $("#q7").val(), $("#q8").val(), $("#q9").val(), $("#q10").val(), ]
            }
            console.log(userData)

            var scoreDifference = 0;
            var friendMatch;

            function friendResults(userData) {
                var currentURL = window.location.origin;
                // ajax call to the friends api
                $.ajax({
                    url: currentURL + "/api/friends",
                    method: "GET"
                }).done(function(friendsData) {
                    //console logging URL to make sure it is the correct path
                    console.log("URL: " + currentURL + "/api/friends");
                    console.log(friendsData);
                    console.log('userData.scores', userData.scores);

                    // matchDifference is a number above the highest calculated score in the friends api
                    var matchDifference = 90;
                    // loop through friendsData
                    for (var i = 0; i < friendsData.length; i++) {
                        scoreDifference = 0;
                        console.log('userData.scores.length', userData.scores.length);
                        console.log('friendsData.length', friendsData.length);
                        console.log('friendsData[i].scores', friendsData[i].scores);
                        console.log('friendsData[i].scores.length', friendsData[i].scores.length);
                        // loop through each score of userData
                        for (var j = 0; j < userData.scores.length; j++) {
                            // calculates the absolute positive of the total difference between friend's scores and user scores
                            var totalDifference = Math.abs(friendsData[i].scores[j] - userData.scores[j]);
                            // add each total difference to scoreDifference
                            scoreDifference += totalDifference;
                        } // end of userData.scores.length for loop
                        // check to see if the score difference is less than the match difference
                        if (scoreDifference < matchDifference) {
                            matchDifference = scoreDifference;
                            friendMatch = friendsData[i];
                        }
                        console.log(friendsData[i].name);
                        console.log('scoreDifference', scoreDifference);
                        console.log('friendMatch', friendMatch);
                        console.log('matchDifference', matchDifference);
                    } // end of for loop for friendsData.length
                    console.log('--------------------------');
                    console.log('Your Match is: ' + friendMatch.name);
                    // trigger modal to display friendMatch details
                    modalStart(friendMatch);
                }); // end of ajax.done() function
            } // end of friendResults() function

            friendResults(userData);
        } // end of validate if statement
        else {
            alert("Please fill out all fields before submitting!");
        } // end of else statement

        return false;

        // function to display new friends in modal
        function modalStart(friendMatch) {

            $("#matchName").append(friendMatch.name);
            $("#matchImg").append(friendMatch.photo);

            $('#resultsModal').modal('open');
        }

        $.post("/api/survey", userData);


    });
    </script>
</body>

</html>
